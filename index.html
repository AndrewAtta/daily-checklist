<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Checklist</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Ubuntu, sans-serif;
      background: #1a1a2e;
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 20px;
      color: #fff;
    }

    .calendar-container {
      background: #16213e;
      border-radius: 12px;
      padding: 24px;
      width: 100%;
      max-width: 700px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .calendar-header h2 {
      font-size: 1.4rem;
      color: #fff;
    }

    .calendar-header button {
      background: #0f3460;
      border: none;
      color: #e0e0e0;
      font-size: 1.2rem;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .calendar-header button:hover { background: #1a5276; }

    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 8px;
      text-align: center;
    }

    .weekdays span {
      font-weight: 600;
      color: #8899aa;
      font-size: 0.85rem;
      padding: 8px 0;
    }

    .days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }

    .day-cell {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
      position: relative;
    }

    .day-cell:not(.empty):hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      z-index: 1;
    }

    .day-cell.empty { cursor: default; }

    .day-cell.today {
      outline: 3px solid #fff;
      outline-offset: -3px;
    }

    .day-cell.selected {
      outline: 3px solid #53c7f0;
      outline-offset: -3px;
    }

    /* Completion color scale */
    .day-cell.complete-0 { background: #c0392b; color: #fff; }
    .day-cell.complete-1 { background: #d35400; color: #fff; }
    .day-cell.complete-2 { background: #d4a017; color: #fff; }
    .day-cell.complete-3 { background: #b7c438; color: #1a1a2e; }
    .day-cell.complete-4 { background: #5dab3e; color: #fff; }
    .day-cell.complete-5 { background: #27ae60; color: #fff; }
    .day-cell.no-tasks   { background: #2c3e6b; color: #8899aa; }

    /* Checklist panel */
    .checklist-panel {
      background: #16213e;
      border-radius: 12px;
      padding: 24px;
      width: 100%;
      max-width: 700px;
      margin-top: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      display: none;
    }

    .checklist-panel.visible { display: block; }

    .checklist-panel h3 {
      font-size: 1.2rem;
      margin-bottom: 16px;
      color: #fff;
    }

    .checklist-panel h3 .carry-over-badge {
      font-size: 0.75rem;
      background: #d35400;
      color: #fff;
      padding: 2px 8px;
      border-radius: 10px;
      margin-left: 8px;
      vertical-align: middle;
    }

    .task-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
      padding: 10px 12px;
      background: #0f3460;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .task-row:hover { background: #1a4a7a; }

    .task-row input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #27ae60;
      cursor: pointer;
      flex-shrink: 0;
    }

    .task-row input[type="text"] {
      flex: 1;
      background: transparent;
      border: none;
      border-bottom: 1px solid #2c3e6b;
      color: #e0e0e0;
      font-size: 0.95rem;
      padding: 4px 0;
      outline: none;
      transition: border-color 0.2s;
    }

    .task-row input[type="text"]:focus {
      border-bottom-color: #53c7f0;
    }

    .task-row input[type="text"].completed-text {
      text-decoration: line-through;
      color: #6a7a8a;
    }

    .task-row .carried-tag {
      font-size: 0.7rem;
      background: #d35400;
      color: #fff;
      padding: 1px 6px;
      border-radius: 8px;
      flex-shrink: 0;
    }

    .legend {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      color: #8899aa;
    }

    .legend-swatch {
      width: 14px;
      height: 14px;
      border-radius: 3px;
    }

    .instructions {
      margin-top: 12px;
      font-size: 0.8rem;
      color: #667788;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Daily Checklist</h1>

  <div class="calendar-container">
    <div class="calendar-header">
      <button id="prev-month">&larr;</button>
      <h2 id="month-label"></h2>
      <button id="next-month">&rarr;</button>
    </div>
    <div class="weekdays">
      <span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span>
      <span>Thu</span><span>Fri</span><span>Sat</span>
    </div>
    <div class="days-grid" id="days-grid"></div>
    <div class="legend">
      <div class="legend-item"><div class="legend-swatch" style="background:#c0392b"></div>0/5</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#d35400"></div>1/5</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#d4a017"></div>2/5</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#b7c438"></div>3/5</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#5dab3e"></div>4/5</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#27ae60"></div>5/5</div>
    </div>
    <p class="instructions">Click a day to view or edit its checklist. Incomplete tasks carry over to today automatically.</p>
  </div>

  <div class="checklist-panel" id="checklist-panel">
    <h3 id="checklist-title"></h3>
    <div id="task-list"></div>
  </div>

  <script>
    const TASKS_PER_DAY = 5;
    const MONTH_NAMES = [
      'January','February','March','April','May','June',
      'July','August','September','October','November','December'
    ];

    let viewYear, viewMonth, selectedDateKey;

    // ---- Storage helpers ----
    function storageKey(dateKey) { return 'checklist_' + dateKey; }

    function loadDay(dateKey) {
      const raw = localStorage.getItem(storageKey(dateKey));
      if (raw) return JSON.parse(raw);
      return null;
    }

    function saveDay(dateKey, tasks) {
      localStorage.setItem(storageKey(dateKey), JSON.stringify(tasks));
    }

    function dateKey(y, m, d) {
      return `${y}-${String(m + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
    }

    function todayKey() {
      const t = new Date();
      return dateKey(t.getFullYear(), t.getMonth(), t.getDate());
    }

    function prevDateKey(dk) {
      const parts = dk.split('-');
      const d = new Date(+parts[0], +parts[1] - 1, +parts[2]);
      d.setDate(d.getDate() - 1);
      return dateKey(d.getFullYear(), d.getMonth(), d.getDate());
    }

    // ---- Carry-over logic ----
    function ensureTodayCarryOver() {
      const tk = todayKey();
      let todayData = loadDay(tk);
      const prevKey = prevDateKey(tk);
      const prevData = loadDay(prevKey);

      if (!prevData) return;

      const incomplete = prevData.filter(t => t.text.trim() !== '' && !t.done);
      if (incomplete.length === 0) return;

      if (!todayData) {
        todayData = [];
        for (let i = 0; i < TASKS_PER_DAY; i++) {
          todayData.push({ text: '', done: false, carried: false });
        }
      }

      // Only carry over if we haven't already carried over
      const alreadyCarried = todayData.some(t => t.carried);
      if (alreadyCarried) return;

      // Fill empty slots with incomplete tasks from yesterday
      let slot = 0;
      for (const task of incomplete) {
        while (slot < TASKS_PER_DAY && todayData[slot].text.trim() !== '') {
          slot++;
        }
        if (slot >= TASKS_PER_DAY) break;
        todayData[slot].text = task.text;
        todayData[slot].done = false;
        todayData[slot].carried = true;
        slot++;
      }
      saveDay(tk, todayData);
    }

    // ---- Completion count ----
    function completionCount(dateKey) {
      const data = loadDay(dateKey);
      if (!data) return -1; // no tasks at all
      const hasTasks = data.some(t => t.text.trim() !== '');
      if (!hasTasks) return -1;
      return data.filter(t => t.done && t.text.trim() !== '').length;
    }

    // ---- Render calendar ----
    function renderCalendar() {
      const label = document.getElementById('month-label');
      label.textContent = `${MONTH_NAMES[viewMonth]} ${viewYear}`;

      const grid = document.getElementById('days-grid');
      grid.innerHTML = '';

      const firstDay = new Date(viewYear, viewMonth, 1).getDay();
      const daysInMonth = new Date(viewYear, viewMonth + 1, 0).getDate();
      const tk = todayKey();

      for (let i = 0; i < firstDay; i++) {
        const empty = document.createElement('div');
        empty.className = 'day-cell empty';
        grid.appendChild(empty);
      }

      for (let d = 1; d <= daysInMonth; d++) {
        const cell = document.createElement('div');
        const dk = dateKey(viewYear, viewMonth, d);
        const count = completionCount(dk);

        cell.className = 'day-cell';
        if (count === -1) {
          cell.classList.add('no-tasks');
        } else {
          cell.classList.add('complete-' + Math.min(count, 5));
        }
        if (dk === tk) cell.classList.add('today');
        if (dk === selectedDateKey) cell.classList.add('selected');

        cell.textContent = d;
        cell.addEventListener('click', () => selectDay(dk));
        grid.appendChild(cell);
      }
    }

    // ---- Select day & show checklist ----
    function selectDay(dk) {
      selectedDateKey = dk;
      renderCalendar();
      renderChecklist(dk);
    }

    function renderChecklist(dk) {
      const panel = document.getElementById('checklist-panel');
      const title = document.getElementById('checklist-title');
      const list = document.getElementById('task-list');

      panel.classList.add('visible');

      const parts = dk.split('-');
      const d = new Date(+parts[0], +parts[1] - 1, +parts[2]);
      const dayName = d.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });

      let data = loadDay(dk);
      if (!data) {
        data = [];
        for (let i = 0; i < TASKS_PER_DAY; i++) {
          data.push({ text: '', done: false, carried: false });
        }
        saveDay(dk, data);
      }

      const hasCarried = data.some(t => t.carried);
      title.innerHTML = dayName + (hasCarried ? '<span class="carry-over-badge">has carry-over tasks</span>' : '');

      list.innerHTML = '';
      for (let i = 0; i < TASKS_PER_DAY; i++) {
        const task = data[i];
        const row = document.createElement('div');
        row.className = 'task-row';

        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = task.done;
        cb.addEventListener('change', () => {
          task.done = cb.checked;
          textInput.classList.toggle('completed-text', task.done);
          saveDay(dk, data);
          renderCalendar();
        });

        const textInput = document.createElement('input');
        textInput.type = 'text';
        textInput.placeholder = `Task ${i + 1}`;
        textInput.value = task.text;
        if (task.done) textInput.classList.add('completed-text');
        textInput.addEventListener('input', () => {
          task.text = textInput.value;
          saveDay(dk, data);
          renderCalendar();
        });

        row.appendChild(cb);
        row.appendChild(textInput);

        if (task.carried) {
          const tag = document.createElement('span');
          tag.className = 'carried-tag';
          tag.textContent = 'carried';
          row.appendChild(tag);
        }

        list.appendChild(row);
      }
    }

    // ---- Navigation ----
    document.getElementById('prev-month').addEventListener('click', () => {
      viewMonth--;
      if (viewMonth < 0) { viewMonth = 11; viewYear--; }
      renderCalendar();
    });

    document.getElementById('next-month').addEventListener('click', () => {
      viewMonth++;
      if (viewMonth > 11) { viewMonth = 0; viewYear++; }
      renderCalendar();
    });

    // ---- Init ----
    function init() {
      const now = new Date();
      viewYear = now.getFullYear();
      viewMonth = now.getMonth();
      ensureTodayCarryOver();
      renderCalendar();
    }

    init();
  </script>
</body>
</html>
